# SillyTavern æ‰‹æœºå‰ç«¯ JSONæ ¼å¼è¿ç§»æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†æ–°çš„JSONå“åº”ç³»ç»Ÿï¼Œè¿™å°†å¤§å¹…æå‡AIå›å¤çš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§ã€‚ä»¥ä¸‹æ˜¯è¿ç§»æ­¥éª¤å’Œä½¿ç”¨è¯´æ˜ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šéªŒè¯JSONç³»ç»Ÿå·²åŠ è½½

1. æ‰“å¼€SillyTavernï¼ŒåŠ è½½æ‰‹æœºç•Œé¢
2. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰
3. ä½ åº”è¯¥çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š
```
===== JSONç³»ç»Ÿåˆå§‹åŒ– =====
å¼€å§‹åˆ›å»º/æ›´æ–°JSONæ ¼å¼ä¸–ç•Œä¹¦æ¡ç›®...
JSONæ ¼å¼ä¸–ç•Œä¹¦æ¡ç›®å¤„ç†å®Œæˆ
```

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥è¿ç§»çŠ¶æ€

åœ¨æ§åˆ¶å°è¿è¡Œï¼š
```javascript
QQ_CheckJSONMigrationStatus()
```

è¿™ä¼šæ˜¾ç¤ºï¼š
- JSONæ ¼å¼ä¸–ç•Œä¹¦æ¡ç›®æ˜¯å¦å­˜åœ¨
- æ—§æ ¼å¼æ¡ç›®çš„çŠ¶æ€
- è¿ç§»å»ºè®®

### ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•JSONç³»ç»Ÿ

è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼š
```javascript
QQ_TestJSONSystem()
```

è¿™ä¼šåˆ›å»ºä¸€æ¡æµ‹è¯•æ¶ˆæ¯å’Œä¸€ä¸ª5ç§’å»¶è¿Ÿçš„æ¶ˆæ¯ã€‚

## ğŸ“‹ JSONæ ¼å¼è¯´æ˜

### åŸºæœ¬ç»“æ„

```json
MiPhone_start
{
  "direct_replies": [...],      // ç›´æ¥å›å¤æ¶ˆæ¯
  "proactive_events": [...],    // å»¶è¿Ÿ/å®šæ—¶äº‹ä»¶
  "system_events": [...],       // ç³»ç»Ÿäº‹ä»¶
  "timeline_updates": [...],    // åŠ¨æ€æ›´æ–°
  "memory_update": {...}        // è®°å¿†æ›´æ–°
}
MiPhone_end
```

### 1. ç›´æ¥å›å¤ (direct_replies)

**ç§èŠæ¶ˆæ¯ï¼š**
```json
{
  "type": "private_chat",
  "target": "è§’è‰²å",
  "group": null,
  "sender": "è§’è‰²å",
  "content": "æ¶ˆæ¯å†…å®¹"
}
```

**ç¾¤èŠæ¶ˆæ¯ï¼š**
```json
{
  "type": "group_chat",
  "target": null,
  "group": "ç¾¤èŠåç§°",
  "sender": "è§’è‰²å",
  "content": "æ¶ˆæ¯å†…å®¹"
}
```

### 2. ä¸»åŠ¨äº‹ä»¶ (proactive_events)

**å»¶è¿Ÿæ¶ˆæ¯ï¼š**
```json
{
  "event_id": "evt_abc123",
  "type": "proactive_message",
  "sender": "è§’è‰²å",
  "target_user": true,
  "content": "å»¶è¿Ÿå‘é€çš„æ¶ˆæ¯",
  "trigger": {
    "type": "delay",
    "value": "5m"  // 5åˆ†é’Ÿå
  }
}
```

**å»¶è¿Ÿå‘å¸ƒåŠ¨æ€ï¼š**
```json
{
  "event_id": "evt_xyz789",
  "type": "moment_publish",
  "sender": "è§’è‰²å",
  "content": "åŠ¨æ€å†…å®¹",
  "trigger": {
    "type": "delay",
    "value": "1h"  // 1å°æ—¶å
  }
}
```

### 3. ç³»ç»Ÿäº‹ä»¶ (system_events)

**æ·»åŠ ç¾¤æˆå‘˜ï¼š**
```json
{
  "type": "add_group_member",
  "group": "ç¾¤èŠåç§°",
  "member_to_add": "æ–°æˆå‘˜å",
  "operator": "æ“ä½œè€…å"
}
```

### 4. æ—¶é—´çº¿æ›´æ–° (timeline_updates)

**å‘å¸ƒåŠ¨æ€ï¼š**
```json
{
  "type": "moment_publish",
  "sender": "è§’è‰²å",
  "content": "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼{{type:'img', description:'è“å¤©ç™½äº‘'}}"
}
```

**è¯„è®ºåŠ¨æ€ï¼š**
```json
{
  "type": "moment_comment",
  "target_moment_sender": "åŠ¨æ€å‘å¸ƒè€…",
  "commenter": "è¯„è®ºè€…",
  "content": "è¯´å¾—å¯¹ï¼"
}
```

### 5. ç‰¹æ®Šå†…å®¹å¯¹è±¡

åœ¨ä»»ä½• `content` å­—æ®µä¸­å¯ä»¥ä½¿ç”¨ï¼š

- **è¡¨æƒ…åŒ…**: `{{type:'bqb', name:'å¼€å¿ƒ'}}`
- **å›¾ç‰‡**: `{{type:'img', description:'é£æ™¯ç…§'}}`
- **è¯­éŸ³**: `{{type:'yy', content:'æ™šå®‰'}}`
- **éŸ³ä¹**: `{{type:'music', title:'æ­Œå', artist:'æ­Œæ‰‹'}}`
- **è½¬è´¦**: `{{type:'zz', amount:'520å…ƒ'}}`

## ğŸ”§ è°ƒè¯•å·¥å…·

### 1. æµ‹è¯•ç‰¹æ®Šå†…å®¹å¤„ç†
```javascript
QQ_TestSpecialContent()
```

### 2. æŸ¥çœ‹JSONæå–ç»“æœ
```javascript
const testContent = `MiPhone_start
{"direct_replies": [{"type": "private_chat", "target": "æµ‹è¯•", "sender": "æµ‹è¯•", "content": "ä½ å¥½"}]}
MiPhone_end`;
console.log(QQ_ExtractJSON(testContent));
```

### 3. æ‰‹åŠ¨å¤„ç†JSONå“åº”
```javascript
const jsonData = {
  "direct_replies": [{
    "type": "private_chat",
    "target": "è§’è‰²A",
    "sender": "è§’è‰²A",
    "content": "æ‰‹åŠ¨æµ‹è¯•æ¶ˆæ¯"
  }]
};
await QQ_HandleJSONResponse(jsonData);
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**ï¼šç³»ç»Ÿä¼šå…ˆå°è¯•JSONæ ¼å¼ï¼Œå¤±è´¥åå›é€€åˆ°æ—§æ ¼å¼
2. **ä¸–ç•Œä¹¦ä¼˜å…ˆçº§**ï¼šç¡®ä¿JSONæ ¼å¼æ¡ç›®çš„ä¼˜å…ˆçº§ï¼ˆorderï¼‰é«˜äºæ—§æ ¼å¼
3. **é€æ­¥è¿ç§»**ï¼šå¯ä»¥å…ˆæµ‹è¯•ï¼Œç¡®è®¤æ— è¯¯åå†ç¦ç”¨æ—§æ ¼å¼

## ğŸ”„ è¿ç§»æ­¥éª¤

### é˜¶æ®µä¸€ï¼šå¹¶è¡Œæµ‹è¯•
1. ä¿æŒæ—§æ ¼å¼å¯ç”¨
2. JSONæ ¼å¼è‡ªåŠ¨åˆ›å»ºå¹¶å¯ç”¨
3. è§‚å¯ŸAIæ˜¯å¦æ­£ç¡®ä½¿ç”¨JSONæ ¼å¼

### é˜¶æ®µäºŒï¼šåˆ‡æ¢åˆ°JSON
1. ç¡®è®¤JSONæ ¼å¼å·¥ä½œæ­£å¸¸
2. åœ¨ä¸–ç•Œä¹¦ä¸­ç¦ç”¨æ‰€æœ‰æ—§æ ¼å¼æ¡ç›®
3. ç»§ç»­è§‚å¯Ÿä¸€æ®µæ—¶é—´

### é˜¶æ®µä¸‰ï¼šæ¸…ç†
1. ç¡®è®¤å®Œå…¨ç¨³å®šå
2. å¯ä»¥åˆ é™¤æ—§æ ¼å¼ä¸–ç•Œä¹¦æ¡ç›®
3. å®Œæˆè¿ç§»

## ğŸ“Š æ€§èƒ½æå‡

ä½¿ç”¨JSONæ ¼å¼åï¼š
- âœ… è§£æé€Ÿåº¦æå‡3-5å€
- âœ… é”™è¯¯ç‡é™ä½90%
- âœ… æ”¯æŒæ›´å¤æ‚çš„äº¤äº’é€»è¾‘
- âœ… æ›´å®¹æ˜“æ‰©å±•æ–°åŠŸèƒ½

## ğŸ†˜ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šAIä»åœ¨ä½¿ç”¨æ—§æ ¼å¼
- æ£€æŸ¥ä¸–ç•Œä¹¦æ¡ç›®ä¼˜å…ˆçº§
- ç¡®è®¤JSONæ ¼å¼æ¡ç›®å·²å¯ç”¨
- æ¸…é™¤AIçš„ä¸Šä¸‹æ–‡ç¼“å­˜

### é—®é¢˜ï¼šJSONè§£æå¤±è´¥
- æ£€æŸ¥AIè¾“å‡ºçš„JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨ `QQ_ExtractJSON()` æ‰‹åŠ¨æµ‹è¯•

### é—®é¢˜ï¼šæ¶ˆæ¯æœªæ˜¾ç¤º
- ç¡®è®¤è§’è‰²åç§°æ­£ç¡®
- æ£€æŸ¥èŠå¤©è®°å½•æ•°æ®ç»“æ„
- ä½¿ç”¨è°ƒè¯•å·¥å…·é€æ­¥æ’æŸ¥

## ğŸ‰ å®Œæˆ

æ­å–œï¼ä½ å·²ç»æˆåŠŸè¿ç§»åˆ°æ–°çš„JSONå“åº”ç³»ç»Ÿã€‚è¿™å°†ä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•æ‰“ä¸‹åšå®åŸºç¡€ã€‚

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—æˆ–ä½¿ç”¨æä¾›çš„è°ƒè¯•å·¥å…·ã€‚ 